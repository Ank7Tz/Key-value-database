syntax = "proto3";

package raftRPC;
option go_package = "key_value_store/internal/raft/RPC";

message Command {
    string op = 1;
    string key = 2;
    bytes value = 3;
}

message LogEntry {
    int64 term = 1;
    Command command = 2;
}

message AppendEntriesRequest {
    string shard_id = 1;
    int64 term = 2;
    string leader_id = 3;
    int64 prev_log_index = 4;
    int64 prev_log_term = 5;
    repeated LogEntry entries = 6;
    int64 leader_commit_index = 7;
}

message AppendEntriesReply {
    string shard_id = 1;
    int64 term = 2;
    bool success = 3;
}

message RequestVote {
    string shard_id = 1;
    int64 term = 2;
    string candidate_id = 3;
    int64 last_log_index = 4;
    int64 last_log_term = 5;
}

message RequestVoteReply {
    string shard_id = 1;
    int64 term = 2;
    bool vote_granted = 3;
}

message ForwardWriteRequest {
    string shard_id = 1;
    string key = 2;
    bytes value = 3;
}

message ForwardWriteReply {
    bool success = 1;
    string error = 2;
    string leader_id = 3;
}

message ForwardReadRequest {
    string shard_id = 1;
    string key = 2;
    bool strong_consistency = 3;
}

message ForwardReadReply {
    bool success = 1;
    string error = 2;
    bytes value = 3;
    string leader_id = 4;
}

message ForwardDeleteRequest {
    string shard_id = 1;
    string key = 2;
}

message ForwardDeleteReply {
    bool success = 1;
    string error = 2;
    string leader_id = 3;
}

service Raft {
    rpc SendAppendEntries(AppendEntriesRequest) returns (AppendEntriesReply) {}
    rpc SendRequestVote(RequestVote) returns (RequestVoteReply) {}
    rpc ForwardWrite(ForwardWriteRequest) returns (ForwardWriteReply) {}
    rpc ForwardRead(ForwardReadRequest) returns (ForwardReadReply) {}
    rpc ForwardDelete(ForwardDeleteRequest) returns (ForwardDeleteReply) {}
}
